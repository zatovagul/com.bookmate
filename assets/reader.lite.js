!function(){"use strict";Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t,e){if(null==t)throw new TypeError("Cannot convert first argument to object");for(var n=Object(t),o=1;o<arguments.length;o++){var r=arguments[o];if(null!=r)for(var i=Object.keys(Object(r)),a=0,s=i.length;a<s;a++){var d=i[a],c=Object.getOwnPropertyDescriptor(r,d);void 0!==c&&c.enumerable&&(n[d]=r[d])}}return n}}),function(){if("object"==typeof window)if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}});else{var g=window.document;t.prototype.THROTTLE_TIMEOUT=100,t.prototype.POLL_INTERVAL=null,t.prototype.USE_MUTATION_OBSERVER=!0,t.prototype.observe=function(e){if(!this._observationTargets.some(function(t){return t.element==e})){if(!e||1!=e.nodeType)throw Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:e,entry:null}),this._monitorIntersections(),this._checkForIntersections()}},t.prototype.unobserve=function(e){this._observationTargets=this._observationTargets.filter(function(t){return t.element!=e}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},t.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},t.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},t.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter(function(t,e,n){if("number"!=typeof t||isNaN(t)||t<0||1<t)throw Error("threshold must be a number between 0 and 1 inclusively");return t!==n[e-1]})},t.prototype._parseRootMargin=function(t){var e=(t||"0px").split(/\s+/).map(function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}});return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e},t.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(e(window,"resize",this._checkForIntersections,!0),e(g,"scroll",this._checkForIntersections,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in window&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(g,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},t.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,n(window,"resize",this._checkForIntersections,!0),n(g,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))},t.prototype._checkForIntersections=function(){var s=this._rootIsInDom(),d=s?this._getRootRect():i();this._observationTargets.forEach(function(t){var e=t.element,n=m(e),o=this._rootContainsTarget(e),r=t.entry,i=s&&o&&this._computeTargetAndRootIntersection(e,d),a=t.entry=new c({time:window.performance&&performance.now&&performance.now(),target:e,boundingClientRect:n,rootBounds:d,intersectionRect:i});r?s&&o?this._hasCrossedThreshold(r,a)&&this._queuedEntries.push(a):r&&r.isIntersecting&&this._queuedEntries.push(a):this._queuedEntries.push(a)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},t.prototype._computeTargetAndRootIntersection=function(t,e){if("none"!=window.getComputedStyle(t).display){for(var n,o,r,i,a,s,d,c,u=m(t),l=y(t),h=!1;!h;){var f=null,p=1==l.nodeType?window.getComputedStyle(l):{};if("none"==p.display)return;if(l==this.root||l==g?(h=!0,f=e):l!=g.body&&l!=g.documentElement&&"visible"!=p.overflow&&(f=m(l)),f&&(o=u,r=Math.max((n=f).top,o.top),i=Math.min(n.bottom,o.bottom),a=Math.max(n.left,o.left),c=i-r,!(u=0<=(d=(s=Math.min(n.right,o.right))-a)&&0<=c&&{top:r,bottom:i,left:a,right:s,width:d,height:c})))break;l=y(l)}return u}},t.prototype._getRootRect=function(){var t;if(this.root)t=m(this.root);else{var e=g.documentElement,n=g.body;t={top:0,left:0,right:e.clientWidth||n.clientWidth,width:e.clientWidth||n.clientWidth,bottom:e.clientHeight||n.clientHeight,height:e.clientHeight||n.clientHeight}}return this._expandRectByRootMargin(t)},t.prototype._expandRectByRootMargin=function(n){var t=this._rootMarginValues.map(function(t,e){return"px"==t.unit?t.value:t.value*(e%2?n.width:n.height)/100}),e={top:n.top-t[0],right:n.right+t[1],bottom:n.bottom+t[2],left:n.left-t[3]};return e.width=e.right-e.left,e.height=e.bottom-e.top,e},t.prototype._hasCrossedThreshold=function(t,e){var n=t&&t.isIntersecting?t.intersectionRatio||0:-1,o=e.isIntersecting?e.intersectionRatio||0:-1;if(n!==o)for(var r=0;r<this.thresholds.length;r++){var i=this.thresholds[r];if(i==n||i==o||i<n!=i<o)return!0}},t.prototype._rootIsInDom=function(){return!this.root||o(g,this.root)},t.prototype._rootContainsTarget=function(t){return o(this.root||g,t)},t.prototype._registerInstance=function(){},t.prototype._unregisterInstance=function(){},window.IntersectionObserver=t,window.IntersectionObserverEntry=c}function c(t){this.time=t.time,this.target=t.target,this.rootBounds=t.rootBounds,this.boundingClientRect=t.boundingClientRect,this.intersectionRect=t.intersectionRect||i(),this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,n=e.width*e.height,o=this.intersectionRect,r=o.width*o.height;this.intersectionRatio=n?+(r/n).toFixed(4):this.isIntersecting?1:0}function t(t,e){var n,o,r,i=e||{};if("function"!=typeof t)throw Error("callback must be a function");if(i.root&&1!=i.root.nodeType)throw Error("root must be an Element");this._checkForIntersections=(n=this._checkForIntersections.bind(this),o=this.THROTTLE_TIMEOUT,r=null,function(){r=r||setTimeout(function(){n(),r=null},o)}),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(i.rootMargin),this.thresholds=this._initThresholds(i.threshold),this.root=i.root||null,this.rootMargin=this._rootMarginValues.map(function(t){return t.value+t.unit}).join(" ")}function e(t,e,n,o){"function"==typeof t.addEventListener?t.addEventListener(e,n,o||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,n)}function n(t,e,n,o){"function"==typeof t.removeEventListener?t.removeEventListener(e,n,o||!1):"function"==typeof t.detatchEvent&&t.detatchEvent("on"+e,n)}function m(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):i()}function i(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function o(t,e){for(var n=e;n;){if(n==t)return!0;n=y(n)}return!1}function y(t){var e=t.parentNode;return e&&11==e.nodeType&&e.host?e.host:e&&e.assignedSlot?e.assignedSlot.parentNode:e}}();var d=c?1:3,r=1024,c=!!window.Android;function i(r){var i,a=g(),n=a?"scrollHeight":"scrollWidth",o=document.body[n],s=0;!function t(){var e=document.body[n];e!==o?(s=0,o=e,i=window.requestAnimationFrame(t)):s<d?(s++,i=window.requestAnimationFrame(t)):function(t){if(window.cancelAnimationFrame(i),!a){var e=l();t=Math.round(t/e)*e}var n,o;n=t,o=g(),n<=u()||(o||(n+=parseInt(window.getComputedStyle(document.body).paddingRight)),document.body.style[o?"height":"width"]=n+"px"),r(a?{itemHeight:t}:{itemWidth:t})}(e)}()}function p(t){return window.readerJS.settings[t]}function g(){return 0===p("columns")}function t(){var t=document.getElementsByTagName("img"),r=p("columns");if(t.length){var e,n,i=h(),a=(e=window.getComputedStyle(document.body),n=parseInt(e.paddingTop)+parseInt(e.paddingBottom),document.documentElement.clientHeight-n);[].forEach.call(t,function(t){if(t.hasAttribute("data-width")){var e=+t.getAttribute("data-width")||1,n=+t.getAttribute("data-height")||1,o=e/n;i<e&&(n=parseInt((e=i)/o)),a<n&&(e=parseInt((n=a)*o)),t.style.width=e+"px",t.style.height=n+"px"}else t.style.maxWidth=r?i+"px":"100%",t.style.maxHeight=a+"px"})}}function u(){return window[g()?"innerHeight":"innerWidth"]}function l(){return window.innerWidth-p("padding")}function h(){var t=p("padding"),e=p("columns"),n=document.documentElement.clientWidth,o=n-2*t;return 2===e&&r<=n?(o-t)/2:o}function f(){return c&&p("hyphenation")}var n="file:///android_asset/",o=["af","as","be","bg","bn","ca","cs","cu","cy","da","de","en","eo","es","et","eu","fi","fr","fur","ga","gl","grc","gu","hi","hr","hsb","hu","hy","ia","id","is","it","ka","kmr","kn","la","lt","lv","ml","mr","nl","nn","oc","or","pa","pl","pms","pt","rm","ro","ru","sa","sk","sl","sv","ta","te","th","tk","tr","uk"];function m(t,e){this.language=t||document.documentElement.lang.toLowerCase(),this.className="hyphenation-1",this.hyphenSymbol="‍­",this.urlHyphenSymbol="​",this.assetsPath=e||n}m.prototype={constructor:m,hyphenator:null,setupHyphenopoly:function(t){function e(){"function"==typeof t&&t()}var n={require:{},setup:{timeout:500,classnames:{}},paths:{maindir:this.assetsPath,patterndir:this.assetsPath+"patterns/"},handleEvent:{hyphenopolyEnd:e,timeout:function(){window.readerJS.settings.hyphenation=0,e()}},dontHyphenateClass:"hyphenation-0",cacheFeatureTests:!0};n.setup.classnames[this.className]={hyphen:this.hyphenSymbol},n.require[this.language]="FORCEHYPHENOPOLY",window.Hyphenopoly=n},init:function(t){if(~o.indexOf(this.language))if(document.querySelector("#hyphenopoly-loader"))window.Hyphenopoly.events.define("hyphenopolyEnd",function(){"function"==typeof t&&t()}),n();else{this.setupHyphenopoly(t);var e=document.createElement("script");e.id="hyphenopoly-loader",e.onload=n,e.async=!0,e.src=this.assetsPath+"Hyphenopoly_Loader.js",document.body.appendChild(e)}else"function"==typeof t&&t();function n(){window.Hyphenopoly.events.dispatch("contentLoaded")}},hyphenate:function(t){return!this.hyphenator&&~o.indexOf(this.language)&&(this.hyphenator=window.Hyphenopoly.createHyphenator(this.language)),this.hyphenator?this.hyphenator(t,this.className):t},unhyphenate:function(t){if(!~o.indexOf(this.language))return t;if(null!==t&&"object"==typeof t)for(var e=0,n=t.childNodes[e];n;)3===n.nodeType?(n.data=n.data.replace(RegExp(this.hyphenSymbol,"g"),""),n.data=n.data.replace(RegExp(this.urlHyphenSymbol,"g"),"")):1===n.nodeType&&this.unhyphenate(n),e+=1,n=t.childNodes[e];else if("string"==typeof t)return t.replace(RegExp(this.hyphenSymbol,"g"),"").replace(RegExp(this.urlHyphenSymbol,"g"),"")}},m.autoHyphenate=function(t){return(new m).init(t)},m.autoUnhyphenate=function(t){(new m).unhyphenate(document.body),t()},window.encodeCFI=function(t,e,n,o){var r=o||"";switch(e.nodeType){case 1:"number"==typeof n&&0<e.childNodes.length&&(e=e.childNodes.item(n)||e.childNodes[0]);break;default:for(n=n||0;;){var i=e.previousSibling;if(!i||1===i.nodeType||7===e.nodeType)break;n+=i.nodeValue.length,e=i}r=":"+n+r}for(;e!==t;){var a=e.parentNode;if(!a){if(9===e.nodeType){var s=e.defaultView;if(s.frameElement){e=s.frameElement,r="!"+r;continue}}break}for(var d=0,c=a.firstChild;d|=1,1!==c.nodeType&&7!==c.nodeType||d++,c!==e;)c=c.nextSibling;r="/"+d+r,e=a}return r},window.decodeCFI=function(t,e){for(var n,o,r=t;0<e.length&&!n;)if(null!==(o=e.match(/^\/(\d+)/)))for(var i=+o[1],a=0,s=r.firstChild;;){if(!s){n="child not found: "+e;break}if(a|=1,1!==s.nodeType&&7!==s.nodeType||a++,a===i){e=e.substr(o[0].length),r=s;break}s=s.nextSibling}else{if(null===(o=e.match(/^!/)))break;r.contentDocument?(r=r.contentDocument,e=e.substr(1)):n="Cannot reference "+r.nodeName+"'s content: "+e}var d=null,c={};if(null!==(o=e.match(/^:(\d+)/))&&(d=+o[1],e=e.substr(o[0].length)),null!==(o=e.match(/^~(-?\d+(\.\d+)?)/))&&(c.time=+o[1],e=e.substr(o[0].length)),null!==(o=e.match(/^@(-?\d+(\.\d+)?),(-?\d+(\.\d+)?)/))&&(c.x=+o[1],c.y=+o[3],e=e.substr(o[0].length)),null!==(o=e.match(/^[ab]/))&&(c.forward="a"===o[0],e=e.substr(1)),null!==d){for(;;){var u=r.nodeValue.length;if(d<u||!c.forward&&d===u)break;var l=r.nextSibling;if(!l){u<d&&(n="Offset out of range: "+d,d=u);break}r=l,d-=u}c.offset=d}if(c.node=r,n?c.error=n:0<e.length&&(c.error="Undecoded: "+e),c.error)throw Error(c.error);return c};var y={hyphenator:new m,getOffsetIndex:function(t){return t.split(":")[1]},calcOffsetWithoutHyphenSymbols:function(t,e){if(f()){var n=this.hyphenator.hyphenSymbol;e-=t.data?(t.data.slice(0,e).split(n).length-1)*n.length:0}return e},calcOffsetWithHyphenSymbols:function(t,e,n){if(f()){var o=this.hyphenator.unhyphenate(t.data).slice(0,this.getOffsetIndex(n));return this.hyphenator.hyphenate(o).length}return e},encode:function(t,e){return e=this.calcOffsetWithoutHyphenSymbols(t,e),window.encodeCFI(window.document,t,e)},decode:function(t){var e=window.decodeCFI(window.document,t);return{node:e.node,offset:e.offset?this.calcOffsetWithHyphenSymbols(e.node,e.offset,t):0}}},w="character",v="word",a=/[ .!:;,?]/,e=3e3,b=null;function E(t){this.granularity=t.granularity||v,this.maxChars=t.maxChars||e,this.points={start:t.startPoint,end:t.endPoint},this.hyphenator=new m,this.cfi=t.cfi}E.prototype={constructor:E,create:function(){return this.cfi?this._createFromCFI(this.cfi):this._createFromPoints(this.points.start,this.points.end)},_createFromCFI:function(t){var e=E.getPositionFromCFI(t);return e?{rects:this._normalizeRects({range:E.getRangeFromPosition(e),position:e})}:{rects:[]}},_shouldSkipLastChar:function(t){var e=t.endContainer.nodeValue;if(!e)return!1;var n=e[t.endOffset-1];return this.granularity===v?a.test(n):" "===n},_createFromPoints:function(t,e){e=e||Object.assign({},t),t=this._normalizePoint(t),e=this._normalizePoint(e);var n=this._getElemFromPoint(t),o=this._getElemFromPoint(e);if(!n&&!o)return null;var r=this._getPointsPosition(t,e);if(!r)return null;var i=E.getRangeFromPosition(r),a=this._createSelection(i);if(!a)return null;this.granularity!==w&&(i=(a=this._modifySelection(a)).getRangeAt(0),r=this._modifyPointsPosition(i,r));var s=a.toString();if(s.length>this.maxChars){try{var d=this._truncateSelection(a,s.length)}catch(t){return null}i=d.range,s=d.text,r=this._modifyPointsPosition(i,r)}return this._isSelectionBetweenDifferentItems(r)?null:(b=r,{text:f()?this.hyphenator.unhyphenate(s):s,truncated:!!d,cfi:this._getCFI(i),rects:this._normalizeRects({range:i,position:r})})},_findNodeItemUuid:function(t){for(var e=null;1===t.nodeType&&(e=t.getAttribute("itemuuid")),t=t.parentNode,!e&&t;);return e},_isSelectionBetweenDifferentItems:function(t){return this._findNodeItemUuid(t.start.node)!==this._findNodeItemUuid(t.end.node)},_truncateSelection:function(t,e){var n=t.getRangeAt(0),o=n.endOffset-(e-this.maxChars);return t.extend(n.endContainer,0<=o?o:n.endContainer.previousSibling.nodeValue.length+o),{range:t.getRangeAt(0),text:t.toString()}},_modifySelection:function(t){var e=t.focusNode,n=t.focusOffset;t.collapse(t.anchorNode,t.anchorOffset);var o=this.granularity===v?v:"sentence",r=["forward","backward"];E.isBackward(t)&&(r=["backward","forward"]),t.modify("move",r[0],w),t.modify("move",r[1],o),t.extend(e,n),t.modify("extend",r[1],w),t.modify("extend",r[0],o);var i=t.getRangeAt(0);if(0===i.endOffset&&i.endContainer===i.startContainer.parentNode.nextElementSibling&&i.endContainer.previousElementSibling){var a=i.endContainer.previousElementSibling.lastChild;3===a.nodeType&&i.setEnd(a,a.nodeValue.length)}if(this.granularity!==v&&i.endContainer===i.startContainer.parentNode){var s=i.endContainer.lastChild;i.setEnd(s,s.nodeValue.length)}return t.isCollapsed&&i.setEnd(i.endContainer,i.endOffset+1),this._shouldSkipLastChar(i)&&i.setEnd(i.endContainer,i.endOffset-1),t.removeAllRanges(),t.addRange(i),t},_modifyPointsPosition:function(t,e){return e.start.node=t.startContainer,e.start.offset=t.startOffset,e.end.node=t.endContainer,e.end.offset=t.endOffset,e},_validatePointPosition:function(t){var e=p("padding");return!(c&&(t.x<e||t.x>l()))},_getPointPosition:function(t){if(!this._validatePointPosition(t))return null;var e=window.document.caretRangeFromPoint(t.x,t.y);return e?{node:e.startContainer,offset:e.startOffset}:null},_getPointsPosition:function(t,e){var n=this._getPointPosition(t),o=this._getPointPosition(e);return!n&&b&&(n=b.start),!o&&b&&(o=b.end),{start:n,end:o}},_normalizePoint:function(t){var e={x:Math.round(t.x-window.pageXOffset),y:Math.round(t.y-window.pageYOffset)};if(c){var n=parseInt(window.getComputedStyle(document.body).fontSize);e.y-=n/4}return e},_getElemFromPoint:function(t){var e=window.document.elementFromPoint(t.x,t.y);return e&&this._isValidSelectionElem(e)?e:null},_isValidSelectionElem:function(t){return t!==window.document.documentElement&&t!==window.document.body&&"IMG"!==t.nodeName},_createSelection:function(t){if(!t)return null;var e=window.document.getSelection();return e.removeAllRanges(),e.addRange(t),e},_getCFI:function(t){var e=t.startContainer,n=t.endContainer,o=t.startOffset,r=t.endOffset;return[y.encode(e,o),y.encode(n,r)].join(",")},_normalizeRects:function(t){var a=window.pageYOffset,s=window.pageXOffset,n=t.position,o=t.range;return this._getNodesInRange(o).reduce(function(t,e){return 3===e.nodeType&&(e===n.start.node&&e===n.end.node?(o.setStart(n.start.node,n.start.offset),o.setEnd(n.end.node,n.end.offset)):e===n.start.node?(o.setStart(n.start.node,n.start.offset),o.setEnd(n.start.node,e.nodeValue.length)):e===n.end.node?(o.setStart(n.end.node,0),o.setEnd(n.end.node,n.end.offset)):(o.setStart(e,0),o.setEnd(e,e.nodeValue.length))),1===e.nodeType&&(o.setStartBefore(e),o.setEndAfter(e)),t.concat([].slice.call(o.getClientRects()))},[]).map(function(t,e,n){var o=n[e-1],r=a+(o&&o.bottom<t.top?o.bottom:t.top),i=a+t.bottom;return{top:r,bottom:i,left:s+t.left,right:s+t.right,width:t.width,height:i-r,baselineHeight:t.height}}).filter(function(t){return t.height&&t.width})},_getNodesInRange:function(t){var e=[],n=t.startContainer.childNodes[t.startOffset]||t.startContainer,o=t.endContainer.childNodes[t.endOffset]||t.endContainer;if(n===o&&0===n.childNodes.length)return[n];do{var r=3===n.nodeType&&0!==n.nodeValue.replace("\n","").length,i=1===n.nodeType&&!!~["IMG","VIDEO"].indexOf(n.nodeName);(r||i)&&e.push(n)}while(n=this.__getNextNode(n,o));return e},__getNextNode:function(t,e,n){return e===t?null:t.firstChild&&!n?t.firstChild:t.parentNode?t.nextSibling||this.__getNextNode(t.parentNode,e,!0):null}},E.of=function(t){return new E(t).create()},E.getRangeFromPosition=function(t){if(!t.start||!t.end)return null;var e=window.document.createRange();return e.setStart(t.start.node,t.start.offset),e.setEnd(t.end.node,t.end.offset),e},E.getPositionFromCFI=function(t){var e=t.split(","),n=null,o=null;try{n=y.decode(e[0])}catch(t){}try{o=y.decode(e[1])}catch(t){}if(!n&&!o)return null;var r=n&&3===n.node.nodeType,i=o&&3===o.node.nodeType&&r&&!n.node.nodeValue.trim()&&!o.node.nodeValue.trim(),a={node:window.document.body.firstElementChild,offset:0},s={node:window.document.body.lastElementChild,offset:0};return{start:i?a:n||a,end:i?s:o||s}},E.isBackward=function(t){var e=t.anchorNode,n=t.anchorOffset,o=t.focusNode,r=t.focusOffset,i=e.compareDocumentPosition(o);return 4===i||0===i&&n<r};var s=null,_=0,I={percent:0},C=/^(?:\/|(?:file|https?):\/\/)/i,O="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",S=null;function T(t,e){window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){try{c?"function"==typeof window.Android[t]&&window.Android[t](JSON.stringify(e)):window.webkit.messageHandlers[t].postMessage(e)}catch(t){}})})}function A(t){t=t||{};var e=l(),n=document.scrollingElement||document.body,o=Math.round(n.scrollLeft/e);t.next?n.scrollLeft=(1+o)*e:t.previous?n.scrollLeft=(o-1)*e:"number"==typeof t.pageNumber?n.scrollLeft=t.pageNumber*e:"number"==typeof t.scrollTop&&(n.scrollTop=t.scrollTop),t.instantly||i(function(){setTimeout(T.bind(null,"onPageShown"),50)})}function R(t){return~["IMG","VIDEO"].indexOf(t.nodeName)}function x(){var t=parseInt(window.getComputedStyle(document.body).paddingTop)+1,e=parseInt(window.getComputedStyle(document.body).paddingLeft)+1,n=parseInt(window.getComputedStyle(document.body).paddingRight)+1,o=parseInt(window.getComputedStyle(document.body).paddingBottom)+1,r=p("padding")+1,i=g();return function(t){var e=document.caretRangeFromPoint(t.left,t.top),n=document.caretRangeFromPoint(t.right,t.bottom);if(!e||!n)return null;var o=document.createRange();return o.setStart(e.startContainer,e.startOffset),o.setEnd(n.endContainer,n.endOffset),o}({top:i&&t===r?0:t,left:e,right:window.innerWidth-n,bottom:window.innerHeight-(i?1:o)})}function N(t){var e=t.startContainer===t.endContainer&&t.startOffset===t.endOffset||1===t.startContainer.nodeType?t.startOffset:t.startOffset+1;return[y.encode(t.startContainer,e),y.encode(t.endContainer,t.endOffset)]}function P(){var t=window[g()?"pageYOffset":"pageXOffset"],e=u(),n=t/(_-e);I={offset:t,percent:isFinite(n)?n:0,cfi:k()}}function k(){var t=parseInt(window.getComputedStyle(document.body).paddingTop)+1,e=[parseInt(window.getComputedStyle(document.body).paddingLeft)+1,t],n=document.caretRangeFromPoint.apply(document,e);if(!n)return null;var o=window.getSelection();o.removeAllRanges(),o.addRange(n),o.modify("extend","forward","word");var r=y.encode(o.focusNode,Math.round((o.baseOffset+o.extentOffset)/2));return[r,r].join(",")}function F(t){if("number"==typeof t.progress)return L(t.progress);if("string"!=typeof t.chapterId)return"string"==typeof t.itemuuid?M(t.itemuuid):"string"==typeof t.markerCFI?j(t.markerCFI,t.scrollToTop):void 0;var e,n,o=(e=t.chapterId,(n=document.getElementById(e))?H(J(n)):null);return null===o?M(t.itemuuid):o}function L(t){var e,n;if(t=Math.min(1,Math.max(0,t)),g())n=t,e=(_-u())*n;else{var o=_-window.innerWidth;e=Math.round(o*t)}return e}function M(t){var e=document.querySelector('[itemuuid="'+t+'"]');return e?H({left:e.offsetLeft,top:Math.max(0,e.offsetTop-2*parseFloat(window.getComputedStyle(e).marginTop))}):null}function H(t){return t[g()?"top":"left"]}function j(t,e){var n,o=g(),r=(n=E.getPositionFromCFI(t))?J(E.getRangeFromPosition(n)):null;if(!r)return c?(S="wrong cfi: "+t,L(.5)):0;var i=H(r);if(o&&!e){var a=window.innerHeight,s=r.height;i-=(a-(s<a?s:0))/2}return i}function B(t){var r,i,e,n,o,a,s=window.readerJS.notchInfo,d=t&&c?(e=s,n=p("padding"),o=h(),n<(a=e&&e.right+e.left)&&(o-=a-n,n=a),"-webkit-column-width:"+o+"px;column-width:"+o+"px;-webkit-column-gap:"+n+"px;column-gap:"+n+"px;"):"";s&&(d+=(r=s,i=window.getComputedStyle(document.body),Object.keys(r).reduce(function(t,e){var n=r[e];if(0<n){var o="padding-"+e;return t.concat(o+":"+Math.max(parseInt(i[o]),n)+"px !important")}return t},[]).join(";"))),document.body.style.cssText=d}function V(t){var e,n,o,r,i,a;switch(t.nodeName.toLocaleLowerCase()){case"a":return t.classList.contains("footnote")?(i=(r=(o=t).getAttribute("href")).replace("#",""),(a=document.getElementById(i))?{type:"footnote",href:r,content:a.innerHTML,rect:J(o)}:null):W(t);case"img":var s={type:"image",src:(n=t).getAttribute("data-src")||n.getAttribute("real-src"),width:parseInt(n.getAttribute("data-width")),height:parseInt(n.getAttribute("data-height")),rect:J(n)},d=t.parentElement,c={};return d&&"a"===d.nodeName.toLocaleLowerCase()&&(c=W(d)),Object.assign({},s,c);case"video":return{type:"video",src:(e=t).getAttribute("src"),rect:J(e)};default:var u=t.parentNode;return u&&"a"==u.nodeName.toLowerCase()?W(u):null}}function W(t){var e={type:"link",href:t.getAttribute("href")},n=[].map.call(t.getClientRects(),q).map(function(t){return Object.assign({rect:t},e)});return 1===n.length?n[0]:n}function q(o){var r=window.pageXOffset,i=window.pageYOffset;return["top","right","bottom","left","width","height"].reduce(function(t,e){var n=o[e];return"top"===e||"bottom"===e?n+=i:"left"!==e&&"right"!==e||(n+=r),t[e]=Math.ceil(n),t},{})}function J(t){if(t.collapsed){var e=t.commonAncestorContainer;~["BR","IMG","HR","VIDEO"].indexOf(e.nodeName)&&(t=e)}return q(t.collapsed&&t.getClientRects()[0]||t.getBoundingClientRect())}function D(){T("onRenderStarted",{})}function z(s){t(),i(function(t){_=t.itemWidth||t.itemHeight;var e,n,o,r,i,a=function(t,e){var n,o,r,i=0,a={elements:(n=document.querySelectorAll("img[src], img[real-src], video[src], a[href]"),[].map.call(n,V).reduce(function(t,e){return t.concat(e)},[])).filter(Boolean),viewport:{width:window.innerWidth,height:window.innerHeight}};if(window.readerJS.openAt){i=F(window.readerJS.openAt);var s="progress"in window.readerJS.openAt;delete window.readerJS.openAt}else r=!!e,o=I.offset||parseInt(L(I.percent)),i=r?o:I.cfi?j(I.cfi,!0):o;if(g()){var d=a.viewport.height,c=Math.max(0,_-d),u=(l=window.innerHeight,Math.ceil(_/l)*l/d);return Object.assign(a,{scroll:{size:_,maxOffset:c,offset:Math.min(c,Math.max(0,i)),pages:u,chapters:G(),items:Y()}})}var l,h=U(i,s),f=U(t.itemWidth);return h===f&&--h,Object.assign(a,{pages:{columnsCount:function(){var t=p("columns");if(t<2)return t;var e=window.getComputedStyle(document.body);return parseFloat(e.columnWidth||e.webkitColumnWidth)<=window.innerWidth/2?2:1}(),page:h,pages:f,chapters:G(),items:Y()}})}(t,s);s&&(e=a,o=(n=Object.assign({},s,{size:_})).size-n.oldSize,r=g(),i=parseInt(r?o:o/l()),n.addToStart&&(r?e.scroll.offset=e.scroll.offset+i:e.pages.page=e.pages.page+i),a=e),S&&(a.error=S,S=null),g()?A({scrollTop:a.scroll.offset,instantly:!0}):A({pageNumber:a.pages.page,instantly:!0}),c&&function(){var t=document.body.querySelectorAll("img[real-src]");if(t.length){var e=l(),n=window.innerHeight,o=(g()?[n+"px","0px",2*n+"px"]:["0px",2*e+"px","0px",e+"px"]).join(" "),r=new IntersectionObserver(function(t,n){t.forEach(function(t){if(t.isIntersecting){var e=t.target;X(e,e.getAttribute("real-src")),n.unobserve(e)}})},{rootMargin:o});[].forEach.call(t,function(t){t.classList.add("loading"),r.observe(t)})}}(),s&&s.saveProgress&&P(),T("onRenderEnded",a)})}function U(t,e){var n=t/l();return e?Math.round(n):Math.floor(n)}function G(){var o=g();return window.readerJS.chapters.map(function(t){var e=F(t.chapteruuid?{chapterId:t.chapteruuid}:{itemuuid:t.itemuuid});if(null===e)return null;var n={itemuuid:t.itemuuid,id:t.chapteruuid};return n[o?"offset":"page"]=o?e:U(e),n}).filter(Boolean)}function Y(){var i=g(),e=[].slice.call(document.querySelectorAll("[itemuuid]")).reduce(function(t,e){var n=e.getAttribute("itemuuid");if(n in t)return t;var o=F({itemuuid:n}),r={itemuuid:n};return r[i?"offset":"page"]=i?o:U(o),t[n]=r,t},{});return Object.keys(e).map(function(t){return e[t]})}function X(t,e){t.src=O;var n=new Image;n.onload=function(){t.classList.remove("loading")},n.src=e,t.getAttribute("data-width")||window.readerJS.fixedLayout||(t.setAttribute("data-width",n.naturalWidth),t.setAttribute("data-height",n.naturalHeight)),t.style.backgroundImage="url("+e+")",t.style.backgroundRepeat="no-repeat",t.style.backgroundPosition="center",t.style.backgroundSize="contain",t.setAttribute("data-src",e)}function K(t){var r=window.readerJS.baseURL,i=window.readerJS.authToken;[].slice.call(t.querySelectorAll("img[src], link[href]")).forEach(function(t){var e=t.getAttribute("src")||t.getAttribute("href");if(!C.test(e)){if(i&&r)var n=new URL(e+"?auth_token="+i,r).href;var o=n||e;"IMG"===t.nodeName?X(t,o):t.href=o}})}function Q(){var t=window.orientation;-90===t&&(t=270);var e=document.documentElement.className,n="orientation-"+t;~e.indexOf("orientation-")?document.documentElement.className=e.replace(/orientation-\d+/,n):document.documentElement.className+=" "+n}function Z(t){for(var e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:function(t){return"CODE"===t.nodeName||"PRE"===t.nodeName?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}},!1);e.nextNode();){var n=e.currentNode,o=(new DOMParser).parseFromString(n.textContent,"text/html");n.textContent=o.body.textContent}}function $(t,e){e&&(t=decodeURIComponent(escape(atob(t))));var n=(new DOMParser).parseFromString(t,"text/html"),o=n.body;return K(n),Z(o),{content:o.innerHTML}}window.addEventListener("load",function(){var o;D(),K(document),Z(document.body),c&&((o=window.readerJS.notchInfo)&&(window.readerJS.notchInfo=Object.keys(o).reduce(function(t,e){var n=o[e];return t[e]=n&&n+("left"===e||"right"===e?20:10),t},{})),B(p("columns"))),[].forEach.call(document.querySelectorAll("video[src]"),function(t){t.addEventListener("click",function(){this.paused?this.play():this.pause()})}),function(t){var e=document.getElementsByTagName("img"),n=0;if(!e.length)return t();function o(){++n===e.length&&t()}[].forEach.call(e,function(t){t.complete||t.hasAttribute("data-width")?o():t.onload=t.onerror=o})}(function(){Q(),f()?m.autoHyphenate(z.bind(null,{saveProgress:!0})):z({saveProgress:!0})})}),c||(window.addEventListener("orientationchange",function(){t(),Q()}),window.addEventListener("resize",function(){D(),B(p("columns")),z()})),c&&document.addEventListener("touchend",function(t){t.preventDefault()}),window.addEventListener("error",function(t){S=t.message}),window.readerJS=Object.assign(window.readerJS,{applySettings:function(t){var e,n,o,r,i=Object.assign({},window.readerJS.settings),a=c||!(1===(o=i,e=Object.keys(r=t).reduce(function(t,e){return r[e]!==o[e]&&t.push(e),t},[])).length&&"theme"===e[0]);return a&&(D(),P()),window.readerJS.settings=Object.assign({},i,t),document.documentElement.className=Object.keys(n=t).reduce(function(t,e){return t.push(e.split(/(?=[A-Z])/).join("-").toLowerCase()+"-"+n[e]),t},[]).join(" "),Q(),a&&(B(t.columns),c&&i.hyphenation!==t.hyphenation?t.hyphenation?m.autoHyphenate(z):m.autoUnhyphenate(z):z()),{willRelayout:a}},createSelection:function(t){var e=E.of(t)||s;return s=e},renderMarkers:function(t){return{markers:t.markers.map(E.of)}},showPage:A,changeContent:function(t){t=t||{};var e=document.body,n=e.firstElementChild;!function(t){if(t.footnotes){var e=document.body,n=t.encoded,o=$(t.footnotes,n),r=e.querySelector(".footnotes");if(!r){var i=e.querySelector("script:first-of-type");return(r=document.createElement("div")).classList.add("footnotes"),r.innerHTML=o.content,e.insertBefore(r,i)}t.addToEnd&&r.lastElementChild.insertAdjacentHTML("afterend",o.content),t.addToStart&&r.firstElementChild.insertAdjacentHTML("beforebegin",o.content)}}(t);var o=e.querySelectorAll(".footnotes"),r=o[o.length-1]||e.querySelector("script:first-of-type"),i=t.encoded,a=_;if(P(),t.addToEnd){var s=$(t.addToEnd,i);r.insertAdjacentHTML("beforebegin",s.content)}if(t.addToStart){var d=$(t.addToStart,i);n.insertAdjacentHTML("beforebegin",d.content)}var c=z.bind(null,{addToStart:d,addToEnd:s,oldSize:a,saveProgress:!0});f()?m.autoHyphenate(c):c()},getViewportCFI:function(){var t=k();return t?{cfi:t}:{error:"wrong viewport position"}},getViewportCFIRange:function(){var t,e=(t=x())?N(t).join(","):null;return e?{cfi:e}:{error:"wrong viewport cfi range"}},isAlive:function(){return!0},touch:function(t){var e=t.at.x,n=t.at.y,o=document.elementFromPoint(e,n);if(o){var r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,null,e,n,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(r)}},addBookmark:function(t){var r=t||150,e=x(),n=e.cloneContents();if(!e)return null;var o=[].map.call(n.childNodes,function(t){return R(t)||1===t.nodeType&&1===t.children.length&&R(t.firstElementChild)?"🖼️":3===t.nodeType?t.data:t.innerText}).reduce(function(t,e,n){var o=t+(0<n?"\n":"")+e;return o.length>r?o.slice(0,r-1)+"…":o},"").trim();return 3===e.startContainer.nodeType&&0!==e.startOffset&&(o="…"+o),o.length<r&&3===e.endContainer.nodeType&&e.endOffset<e.endContainer.nodeValue.length&&(o+="…"),{content:o,cfi:N(e).join(",")}},saveProgress:P})}();
